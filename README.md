# 机器人DH参数优化项目

本项目旨在通过对机器人正向运动学和误差优化算法的综合应用，对机器人DH参数进行优化，从而提高机器人末端位置预测的精度。项目总体流程及模块划分如下：

## 1. 项目流程概述

1. **数据生成**  
   - 在 `tools/generate_random_positions.py` 中，利用机器人关节限位信息随机生成关节角度，并计算对应的末端位置信息。  
   - 数据包括理想数据与添加噪声后的实际测量数据，并保存到相应的文件中（例如 `Pos_real.txt`）。

2. **数据加载与处理**  
   - 在 `optimize/data_utils.py` 中，通过 `load_data` 函数读取测量数据，将关节角度和末端位置转换为 NumPy 数组，便于后续处理。  
   - 通过 `save_formatted_dh_params` 函数，将优化后的DH参数以清晰、可读的格式写入文本文件，并附带参数变化及统计信息。

3. **正向运动学计算与误差评估**  
   - 在 `optimize/forward_kinematics.py` 中，定义了机器人类 `RokaeRobot`，包含初始DH参数和关节限位。  
   - `optimize/kinematics.py` 中的 `forward_kinematics_with_params` 根据给定DH参数和关节角计算末端位置；`error_function` 则计算预测位置与测量位置之间的误差，为优化算法提供目标函数。

4. **优化算法**  
   - **全局搜索**：利用差分进化（DE）算法在初始参数附近进行全局搜索，寻找一个较优解。  
   - **局部优化**：在全局搜索得到的最佳解基础上，采用 Levenberg-Marquardt (LM) 算法进一步提高精度。  
   - 这些算法在 `optimize/optimization.py` 中实现，并记录了收敛历史供后续分析。

5. **结果验证与可视化**  
   - 在 `optimize/visualization.py` 中，通过 `plot_convergence` 绘制优化过程的收敛曲线，以及 `plot_error_comparison` 展示优化前后的误差对比。  
   - 在 `optimize/validation.py` 中，通过统计每个样本的误差，验证优化效果，同时保存了结果和统计信息到文本文件中。

6. **主程序**  
   - 主入口文件 `dh_optimizer.py` 按照上述流程依次调用各模块功能：数据读取、初始参数获取、全局与局部优化、结果验证和结果保存。
   - 执行方式推荐在项目根目录下使用模块方式运行：
     ```bash
     python -m dh_optimizer
     ```
     这样确保包内的相对导入和文件路径能正确解析。

## 2. 项目模块结构

```
paramOptimize/
├── dh_optimizer.py              # 主程序入口
├── README.md                    # 项目总结及使用说明
├── tools/
│   └── generate_random_positions.py  # 数据生成工具
└── optimize/
    ├── __init__.py              # 包初始化，导出常用函数
    ├── data_utils.py            # 数据加载与结果保存
    ├── forward_kinematics.py    # 正向运动学模型及机器人定义
    ├── kinematics.py            # 前向运动学计算和误差函数
    ├── optimization.py          # 差分进化与LM优化算法
    ├── validation.py            # 优化结果验证和统计
    ├── visualization.py         # 收敛曲线和误差对比图的绘制
    └── utils.py                 # 辅助工具函数（如目录创建、打印函数等）
```

## 3. 项目总结

- **功能目标**：通过优化机器人DH参数，缩小正向运动学计算的误差，进而提高机器人末端位置预测的精度，对机器人参数进行精细校准。

- **技术路线**：  
  - **数据生成**：利用机器人关节限位生成随机数据，增加噪声模拟实际测量情况。
  - **误差计算**：基于正向运动学计算末端位置，与真实测量数据比对，构建目标函数。
  - **优化算法**：先使用全局搜索方法（DE算法）粗调，再使用局部优化方法（LM算法）细调，达到较高的拟合精度。
  - **结果验证**：分别计算优化前后误差，统计并绘图展示，直观展示优化效果。

- **项目优势**：  
  - 结构模块化，代码清晰维护简单。
  - 支持数据的自动生成、加载与保存，同时可视化优化过程和结果对比。
  - 用于机器人实际应用前的DH参数精细校准，具有较高的参考价值。

---

通过本项目的流程实现和各模块协同工作，实现了机器人DH参数的高效优化，为后续机器人校准和运动控制提供了坚实的理论和实践基础。